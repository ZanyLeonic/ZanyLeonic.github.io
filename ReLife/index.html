<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>Authorization success!</title>
    <style type="text/css">
      body {
        font-family: Sans-Serif;
      }
    </style>
  </head>
  <body onload="getCode()">
    <h1 id="title">Authenication completed!</h1>
    <div id="text"><p>Copy this code to the bot with <code>/ocode</code> in DMs<br><input id="code" type="text" onclick="copyToBoard()"></p></div>
    <script type="text/javascript">
      function getCode() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        
	if (urlParams.get("code") == "") {
		document.getElementById("title").innerText = "Authenication incomplete";
		document.getElementById("text").innerHTML = "<p>Try again or close this window.";
	} else {
        	document.getElementById("code").value = urlParams.get("code");
		var input = document.querySelector('input'); // get the input element
		input.addEventListener('input', resizeInput); // bind the "resizeInput" callback on "input" event
		resizeInput.call(input); // immediately call the function
	}
      }
      
      function copyToBoard() {
        /* From https://www.w3schools.com/howto/howto_js_copy_clipboard.asp */
        /* Get text element */
        var copyText = document.getElementById("code");

        /* Select the text field */
        copyText.select();
        copyText.setSelectionRange(0, 99999); /* For mobile devices */

        /* Copy the text inside the text field */
        navigator.clipboard.writeText(copyText.value);
      }

      function resizeInput() {
        this.style.width = this.value.length + "ch";
      }
    </script>
  </body>
</html>
